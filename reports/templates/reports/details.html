{% extends 'base.html' %}
{% block title %}Report Details{% endblock %}
{% block header_lines %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'reports/nv.d3.css' %}"/>
    <style>

        {# We want to fill the page with as much of the graph as is possible#}
        html, body {
            height: 99%;
        }

        #chart {
            height: 60%;
            width: 95%;
        }
    </style>
{% endblock %}

{% block h1 %}{{ report.report_title }}{% endblock %}
{% block content %}

    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

    <div id="chart">
        <svg></svg>
    </div>

    <p>The <a href="{% url 'reports:csv' report.id %}">csv file</a> behind this graph</p>

    <form action="{% url 'reports:vote' report.id %}" method="post">
        {% csrf_token %}
        {% for choice in report.choice_set.all %}
            <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}"/>
            <label for="choice{{ forloop.counter }}">{{ choice.choice_text }}</label><br/>
        {% endfor %}
        <input type="submit" value="Vote"/>
    </form>

    <script src="//d3js.org/d3.v3.js"></script>
    <script src="//cdn.rawgit.com/novus/nvd3/v1.8.1/build/nv.d3.js"></script>
    {#    TODO: make the following a tag? Or work out how not to hardcode static path?#}
    <script src="/static/reports/{{ report.d3_file_name }}"></script>
    <script>
        report.d3.render("{% url 'reports:csv' report.id %}")
    </script>

{% endblock %}