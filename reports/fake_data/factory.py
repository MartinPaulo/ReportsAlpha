import copy

from reports.fake_data import cloud

MONTH = 1475323200000
THREE_MONTHS = 1470052800000
SIX_MONTHS = 1462104000000

faculty_quota = [
    {"key": "VCAMCM",
     "values": [[1451649600000, 0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "VAS",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "FoS",
     "values": [[1451649600000, 15.0], [1454328000000, 15.0], [1456833600000, 15.0], [1459512000000, 15.0],
                [1462104000000, 15.0], [1464782400000, 15.0], [1467374400000, 15.0], [1470052800000, 15.0],
                [1472731200000, 15.0], [1475323200000, 15.0], [1478001600000, 15.0], [1480593600000, 15.0]]},
    {"key": "MDHS",
     "values": [[1451649600000, 10], [1454328000000, 10], [1456833600000, 10], [1459512000000, 15],
                [1462104000000, 20], [1464782400000, 30], [1467374400000, 30], [1470052800000, 30],
                [1472731200000, 30], [1475323200000, 30], [1478001600000, 30], [1480593600000, 10]]},
    {"key": "MLS",
     "values": [[1451649600000, 5.0], [1454328000000, 15.0], [1456833600000, 15.0], [1459512000000, 15.0],
                [1462104000000, 15.0], [1464782400000, 15.0], [1467374400000, 15.0], [1470052800000, 15.0],
                [1472731200000, 15.0], [1475323200000, 15.0], [1478001600000, 15.0], [1480593600000, 15.0]]},
    {"key": "MSE",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "MGSE",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "FBE",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "FoA",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]},
    {"key": "ABP",
     "values": [[1451649600000, 5.0], [1454328000000, 5.0], [1456833600000, 5.0], [1459512000000, 5.0],
                [1462104000000, 5.0], [1464782400000, 5.0], [1467374400000, 5.0], [1470052800000, 5.0],
                [1472731200000, 5.0], [1475323200000, 5.0], [1478001600000, 5.0], [1480593600000, 5.0]]}
]

allocated = [
    {
        "key": "total",
        "values": [
            [1451649600000, 920.35], [1454328000000, 996.62], [1456833600000, 1041.61], [1459512000000, 1080.32],
            [1462104000000, 1121.99], [1464782400000, 1121.99], [1467374400000, 1181.2], [1470052800000, 1210.6],
            [1472731200000, 1230.8], [1475323200000, 1263.22], [1478001600000, 1305.10], [1480593600000, 1428.20]
        ]
    },
    {
        "key": "market",
        "values": [
            [1451649600000, 320], [1454328000000, 340.55], [1456833600000, 360.4], [1459512000000, 380],
            [1462104000000, 400.5], [1464782400000, 420.60], [1467374400000, 420.67], [1470052800000, 430.20],
            [1472731200000, 440], [1475323200000, 450], [1478001600000, 510.2], [1480593600000, 510.2]
        ]
    },
    {
        "key": "vault",
        "values": [
            [1451649600000, 500], [1454328000000, 535.67], [1456833600000, 550.2], [1459512000000, 560.32],
            [1462104000000, 570.5], [1464782400000, 600.10], [1467374400000, 620], [1470052800000, 620],
            [1472731200000, 630], [1475323200000, 655], [1478001600000, 655], [1480593600000, 705]
        ]
    },
    {
        "key": "compute",
        "values": [
            [1451649600000, 100.34], [1454328000000, 120.4], [1456833600000, 130.56], [1459512000000, 140],
            [1462104000000, 150.99], [1464782400000, 160.50], [1467374400000, 169.99], [1470052800000, 180.6],
            [1472731200000, 193.22], [1475323200000, 200.10], [1478001600000, 205], [1480593600000, 213]
        ]
    }
]

used = [
    {
        "key": "total",
        "values": [
            [1451649600000, 462.82], [1454328000000, 542.62], [1456833600000, 572.16], [1459512000000, 605.32],
            [1462104000000, 605.32], [1464782400000, 632.99], [1467374400000, 637.43], [1470052800000, 686.26],
            [1472731200000, 711.90], [1475323200000, 734.82], [1478001600000, 751.94], [1480593600000, 868.61]
        ]
    },
    {
        "key": "market",
        "values": [
            [1451649600000, 124.48], [1454328000000, 136.55], [1456833600000, 145.4], [1459512000000, 157],
            [1462104000000, 165.5], [1464782400000, 170.60], [1467374400000, 175.67], [1470052800000, 180.5],
            [1472731200000, 196.40], [1475323200000, 200], [1478001600000, 230.35], [1480593600000, 264.35]
        ]
    },
    {
        "key": "vault",
        "values": [
            [1451649600000, 288], [1454328000000, 335.67], [1456833600000, 350.2], [1459512000000, 368.32],
            [1462104000000, 370.5], [1464782400000, 380.33], [1467374400000, 420.6], [1470052800000, 440.10],
            [1472731200000, 445.20], [1475323200000, 455.50], [1478001600000, 497.88], [1480593600000, 497.88]
        ]
    },
    {
        "key": "compute",
        "values": [
            [1451649600000, 50.34], [1454328000000, 70.4], [1456833600000, 76.56], [1459512000000, 80],
            [1462104000000, 96.99], [1464782400000, 86.50], [1467374400000, 89.99], [1470052800000, 91.3],
            [1472731200000, 93.22], [1475323200000, 96.44], [1478001600000, 96.44], [1480593600000, 106.38]
        ]
    }
]


def get_faculty_quota():
    return faculty_quota


def lookup_value(date, storage_type, lookup_field):
    for entry in lookup_field:
        if entry['key'] == storage_type:
            for s in entry['values']:
                if s[0] == date:
                    return s[1]
    return 0


def get_faculty_value(duration, storage_type, lookup_field):
    data = copy.deepcopy(faculty_quota)
    for entry in data:
        new_values = []
        for s in entry['values']:
            value = lookup_value(s[0], storage_type, lookup_field)
            s[1] = value / s[1] if s[1] != 0 else 0
            if (duration == 'oneMonth') and s[0] > MONTH:
                new_values.append(s)
            elif (duration == 'threeMonths') and s[0] > THREE_MONTHS:
                new_values.append(s)
            elif (duration == 'sixMonths') and s[0] > SIX_MONTHS:
                new_values.append(s)
        if len(new_values) > 0:
            entry['values'] = new_values
    return data


def get_used_value(s, used_entry):
    used_value = 0
    for u in used_entry['values']:
        if u[0] == s[0]:
            return u[1]
    return used_value


def get_faculty_headroom(duration, storage_type):
    allocated_values = get_faculty_value(duration, storage_type, allocated)
    used_values = get_faculty_value(duration, storage_type, used)
    i = 0
    for entry in allocated_values:
        used_entry = used_values[i]
        for s in entry['values']:
            used_value = get_used_value(s, used_entry)
            s[1] -= used_value
        i += 1
    return allocated_values


def get(path, duration, category):
    quota = {}
    if path.endswith('quota/'):
        quota = get_faculty_quota()
    elif path.endswith('faculty_allocated/'):
        quota = get_faculty_value(duration, category, allocated)
    elif path.endswith('faculty_used/'):
        quota = get_faculty_value(duration, category, used)
    elif path.endswith('faculty_headroom/'):
        quota = get_faculty_headroom(duration, category)
    elif path.endswith('cloud_uptime/'):
        quota = cloud.get_uptime(duration, category)
    return quota
